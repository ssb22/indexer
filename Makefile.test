# -*- mode: Makefile -*-
test: test_ohi_latex test_anemone
test_ohi_latex:
	echo kǎoyàn|python2.7 ohi_latex.py --dry-run
	grep '\\kao3\\yan4' index.tex >/dev/null
	echo kǎoyàn|python3 ohi_latex.py --dry-run
	grep '\\kao3\\yan4' index.tex >/dev/null
test_anemone:
	ruff check anemone.py
	sox -n test.wav synth 3 sine 300-3300
	./anemone.py test.wav # title from filename
	unzip -c output_daisy.zip ncc.html|grep '>test<' >/dev/null
	./anemone.py --daisy3 test.wav
	unzip -c output_daisy.zip navigation.ncx|grep '>test<' >/dev/null
	./anemone.py --daisy3 test.wav '<h1 data-pid="T">heading</h1><p data-pid="U">para</p>' '{"markers":[{"id":"T","time":"1"},{"id":"U","time":"2"}]}'
	unzip -c output_daisy.zip navigation.ncx|grep '<navLabel><text>heading</text><audio src="0001.mp3" clipBegin="0:00:00.000" clipEnd="0:00:02.000"/></navLabel>' >/dev/null
	unzip -c output_daisy.zip 0001.smil|grep '<audio src="0001.mp3" clipBegin="0:00:02.000" clipEnd="0:00:03.000" id="aud1.1" />' >/dev/null
.PHONY: test test_ohi_latex test_anemone
